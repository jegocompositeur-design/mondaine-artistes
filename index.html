<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <!-- Viewport optimisÃ© pour mobile et encoches (notch) -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="description" content="Intranet Artistes Mondaine - Gestion de planning et bibliothÃ¨que audio.">
    <meta name="theme-color" content="#1a0b2e">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <title>MONDAINE ARTISTES | Intranet</title>
    
    <!-- FAVICON -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸŽ¤</text></svg>">

    <!-- LIBRARIES -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- GOOGLE FONTS -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800&family=Playfair+Display:wght@700;900&display=swap');

        /* RESET & BASE */
        :root { --primary: #d946ef; --dark: #050505; --glass: rgba(255, 255, 255, 0.05); }
        body { font-family: 'Montserrat', sans-serif; background: radial-gradient(circle at top left, #1a0b2e 0%, #050505 100%); color: #e5e5e5; -webkit-font-smoothing: antialiased; }
        h1, h2, h3, .font-serif { font-family: 'Playfair Display', serif; }
        
        /* ANIMATIONS */
        .fade-in { animation: fadeIn 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        
        @keyframes slideDown { from { opacity: 0; transform: translateY(-10px); max-height: 0; } to { opacity: 1; transform: translateY(0); max-height: 300px; } }
        .schedule-dropdown { animation: slideDown 0.3s ease-out forwards; overflow: hidden; }

        /* SCROLLBAR */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: #0f0f13; }
        ::-webkit-scrollbar-thumb { background: #4a1d96; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #d946ef; }

        /* UI ELEMENTS */
        .nav-item.active { border-left-color: #d946ef; background: linear-gradient(90deg, rgba(217, 70, 239, 0.1), transparent); color: #d946ef; text-shadow: 0 0 15px rgba(217, 70, 239, 0.4); }
        .sidebar-collapsed { width: 5rem !important; }
        .sidebar-collapsed .nav-text, .sidebar-collapsed .logo-text { display: none !important; }
        
        /* MOBILE RESPONSIVE FIXES */
        .sticky-col {
            position: sticky;
            left: 0;
            z-index: 30;
            background-color: #0a0a0c;
            box-shadow: 4px 0 15px rgba(0,0,0,0.5);
            border-right: 1px solid rgba(255,255,255,0.1);
        }
        .row-active.sticky-col { z-index: 45 !important; background-color: #1a0b2e !important; }

        @media (max-width: 768px) {
            .track-item { padding-top: 1rem; padding-bottom: 1rem; font-size: 0.95rem; }
            .artist-pill { padding: 0.75rem 0.5rem; font-size: 0.75rem; }
        }

        /* PLANNING CELLS */
        .planning-cell { transition: all 0.2s; border-color: rgba(255,255,255,0.05); }
        .planning-cell.interactive:hover { filter: brightness(1.3); border-color: rgba(255,255,255,0.3); transform: translateY(-2px); z-index: 5; box-shadow: 0 5px 15px rgba(0,0,0,0.5); }
        
        .artist-pill { transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .artist-pill.selected { box-shadow: 0 0 20px rgba(255,255,255,0.3); transform: scale(1.05); z-index: 10; border: 1px solid rgba(255,255,255,0.8); }

        /* HIGHLIGHTS */
        .cell-highlight { box-shadow: 0 0 25px rgba(255, 255, 255, 0.5) !important; border: 2px solid white !important; z-index: 50 !important; transform: scale(1.1) !important; filter: brightness(1.2); }
        .cell-dimmed { opacity: 0.15 !important; filter: grayscale(100%) blur(1px) !important; transform: scale(0.95); pointer-events: none; }
        .row-active { box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.8), 0 0 20px rgba(255, 255, 255, 0.15) !important; z-index: 40; }

        .month-char { color: #ffffff; line-height: 0.85; font-weight: 900; text-shadow: 0 2px 10px rgba(0,0,0,0.5); }
        .month-sidebar { background: linear-gradient(180deg, #d946ef 0%, #7e22ce 100%); box-shadow: 5px 0 30px rgba(0,0,0,0.6); }

        /* ADMIN & FORMS */
        .glass-panel { background: rgba(10, 5, 20, 0.7); backdrop-filter: blur(25px); -webkit-backdrop-filter: blur(25px); border: 1px solid rgba(255,255,255,0.05); }
        .admin-textarea { background-color: rgba(0,0,0,0.4); border: 1px solid rgba(255,255,255,0.1); color: #ddd; font-family: 'Courier New', monospace; font-size: 0.85rem; transition: all 0.3s; }
        .admin-textarea:focus { outline: none; border-color: #d946ef; box-shadow: 0 0 15px rgba(217, 70, 239, 0.2); background-color: rgba(0,0,0,0.6); }

        /* AUDIO PLAYER */
        .track-item { transition: all 0.2s; border-bottom: 1px solid rgba(255,255,255,0.03); }
        .track-item.active { background: linear-gradient(90deg, rgba(217, 70, 239, 0.15) 0%, transparent 100%); border-left: 3px solid #d946ef; padding-left: 1.25rem; color: #f0abfc; }
        
        input[type=range] { -webkit-appearance: none; background: transparent; }
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; height: 12px; width: 12px; border-radius: 50%; background: #d946ef; cursor: pointer; margin-top: -5px; box-shadow: 0 0 10px #d946ef; }
        input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 2px; cursor: pointer; background: rgba(255,255,255,0.2); }

        .speed-btn { font-size: 9px; font-weight: 700; padding: 4px 8px; border-radius: 4px; border: 1px solid rgba(255,255,255,0.1); color: #9ca3af; transition: all 0.2s; }
        .speed-btn.active-speed { background: rgba(217, 70, 239, 0.3); color: #f0abfc; border-color: #d946ef; }

        /* UTILS */
        #loading-overlay { position: fixed; inset: 0; background: #050505; z-index: 9999; display: flex; justify-content: center; align-items: center; transition: opacity 0.5s; }
        .toast-visible { animation: slideUpFade 3s ease-in-out forwards; }
        @keyframes slideUpFade { 0% { transform: translate(-50%, 100%); opacity: 0; } 10% { transform: translate(-50%, -20%); opacity: 1; } 90% { transform: translate(-50%, -20%); opacity: 1; } 100% { transform: translate(-50%, 100%); opacity: 0; } }

        .upload-btn { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100px; width: 100%; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 0.75rem; cursor: pointer; transition: all 0.3s; color: #9ca3af; }
        .upload-success { background: rgba(22, 163, 74, 0.8) !important; color: white !important; }
        .upload-loading { opacity: 0.7; pointer-events: none; animation: pulse 1.5s infinite; }
    </style>
</head>
<body class="flex h-screen overflow-hidden text-sm md:text-base selection:bg-fuchsia-500 selection:text-white">

    <!-- LOADING SCREEN -->
    <div id="loading-overlay">
        <div class="flex flex-col items-center">
            <div class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-fuchsia-500 mb-4"></div>
            <p class="text-white font-serif tracking-[0.3em] text-xs animate-pulse uppercase">Mondaine Artistes</p>
        </div>
    </div>

    <!-- FIREBASE MODULE -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, doc, setDoc, deleteDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { getStorage, ref, uploadBytesResumable, getDownloadURL, listAll } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-storage.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCTiIaFghO0asxaxp_jtfkUGZj3sSC9ipM",
            authDomain: "mondaine-artistes.firebaseapp.com",
            projectId: "mondaine-artistes",
            storageBucket: "mondaine-artistes.firebasestorage.app",
            messagingSenderId: "490049497488",
            appId: "1:490049497488:web:80f210d3e70689bbdbeb15"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const storage = getStorage(app);
        const appId = 'mondaine-prod';

        window.db = db; window.auth = auth; window.appId = appId; window.storage = storage;
        window.collection = collection; window.doc = doc; window.setDoc = setDoc; window.deleteDoc = deleteDoc; window.onSnapshot = onSnapshot;
        window.storageRef = ref; window.uploadBytesResumable = uploadBytesResumable; window.getDownloadURL = getDownloadURL; window.listAll = listAll;

        const initAuth = async () => {
            try { await signInAnonymously(auth); console.log("ConnectÃ©"); } 
            catch (e) { console.error(e); }
        };
        initAuth();

        onAuthStateChanged(auth, (user) => { if (user) window.initRealtimeData(); });
    </script>

    <!-- SIDEBAR -->
    <aside id="main-sidebar" class="w-20 md:w-64 bg-black/80 backdrop-blur-xl border-r border-white/5 flex flex-col z-50 shrink-0 transition-all duration-300 relative">
        <div class="p-4 md:p-8 text-center">
            <div class="w-10 h-10 md:w-16 md:h-16 bg-gradient-to-br from-gray-900 to-black rounded-full mx-auto flex items-center justify-center mb-3 border border-purple-500/30">
                <i class="fas fa-microphone-alt text-xl md:text-2xl text-fuchsia-500"></i>
            </div>
            <h2 class="hidden md:block logo-text text-[10px] tracking-[0.2em] uppercase text-purple-300 font-bold">ON AIR</h2>
        </div>
        
        <nav class="flex-1 mt-6 relative z-50">
            <ul class="space-y-2">
                <li><a href="#" onclick="showPage('home')" id="nav-home" class="nav-item active flex items-center justify-center md:justify-start px-2 md:px-8 py-4 text-gray-400 hover:text-white border-l-4 border-transparent"><i class="fas fa-home w-5"></i><span class="hidden md:inline nav-text ml-4 font-bold text-xs">ACCUEIL</span></a></li>
                <li><a href="#" onclick="showPage('planning')" id="nav-planning" class="nav-item flex items-center justify-center md:justify-start px-2 md:px-8 py-4 text-gray-400 hover:text-white border-l-4 border-transparent"><i class="far fa-calendar-alt w-5"></i><span class="hidden md:inline nav-text ml-4 font-bold text-xs">PLANNING</span></a></li>
                <li><a href="#" onclick="showPage('setlist')" id="nav-setlist" class="nav-item flex items-center justify-center md:justify-start px-2 md:px-8 py-4 text-gray-400 hover:text-white border-l-4 border-transparent"><i class="fas fa-music w-5"></i><span class="hidden md:inline nav-text ml-4 font-bold text-xs">SETLISTE</span></a></li>
                <li><a href="#" onclick="showPage('audio')" id="nav-audio" class="nav-item flex items-center justify-center md:justify-start px-2 md:px-8 py-4 text-gray-400 hover:text-white border-l-4 border-transparent"><i class="fas fa-headphones w-5"></i><span class="hidden md:inline nav-text ml-4 font-bold text-xs">AUDIO</span></a></li>
                <li id="admin-nav-item" class="hidden mt-8 border-t border-white/5 pt-4">
                    <a href="#" onclick="showPage('admin-panel')" id="nav-admin-panel" class="nav-item flex items-center justify-center md:justify-start px-2 md:px-8 py-4 text-red-400 border-l-4 border-transparent"><i class="fas fa-cogs w-5"></i><span class="hidden md:inline nav-text ml-4 font-bold text-xs">ADMIN</span></a>
                </li>
            </ul>
        </nav>

        <div class="p-4 border-t border-white/5 text-center">
             <button onclick="toggleSidebar()" class="mb-4 text-gray-500 hover:text-white w-full flex items-center justify-center"><i id="sidebar-icon" class="fas fa-compress-alt text-lg"></i></button>
             <button onclick="toggleAdminMode()" id="admin-toggle-btn" class="text-gray-500 hover:text-fuchsia-400 w-full flex items-center justify-center py-4"><i class="fas fa-lock"></i></button>
        </div>
    </aside>

    <!-- MAIN -->
    <main class="flex-1 relative overflow-hidden w-full bg-[#050505]">
        <!-- ACCUEIL -->
        <section id="home" class="page-section h-full w-full absolute inset-0 z-10 overflow-y-auto">
            <div class="min-h-full w-full flex flex-col justify-center items-center text-center p-4 relative" style="background-image: linear-gradient(rgba(0,0,0,0.5), rgba(5,5,5,0.95)), url('https://images.unsplash.com/photo-1514525253440-b393452e8d26?q=80&w=2000&auto=format&fit=crop'); background-size: cover;">
                <div class="border border-white/10 p-8 md:p-16 backdrop-blur-md bg-black/60 fade-in rounded-sm mb-8">
                    <h1 class="text-5xl md:text-8xl font-black text-white tracking-tighter mb-2">MONDAINE</h1>
                    <h2 class="text-2xl md:text-3xl text-fuchsia-500 tracking-[0.6em] font-light">ARTISTES</h2>
                </div>
                <div id="home-news-container" class="w-full max-w-2xl space-y-4 fade-in hidden z-20"></div>
            </div>
        </section>

        <!-- PLANNING -->
        <section id="planning" class="page-section h-full w-full absolute inset-0 hidden flex flex-col fade-in bg-[#0a0a0c]">
            <header class="flex justify-between items-center p-6 border-b border-white/5 bg-black/40 backdrop-blur-sm shrink-0">
                <h2 class="text-3xl text-white font-black uppercase">Planning</h2>
                <div class="flex items-center gap-2 bg-white/5 rounded-full px-4 py-1.5">
                    <button onclick="changeMonth(-1)" class="p-1"><i class="fas fa-chevron-left"></i></button>
                    <span id="current-month-display" class="w-32 text-center font-bold text-xs uppercase tracking-widest">MOIS</span>
                    <button onclick="changeMonth(1)" class="p-1"><i class="fas fa-chevron-right"></i></button>
                </div>
            </header>
            <div class="flex flex-1 overflow-hidden">
                <div class="flex-1 overflow-auto" id="planning-scroll-container">
                    <div class="flex" id="planning-container"></div>
                    <!-- AJOUT : Liste des artistes pour mobile sous le planning -->
                    <div id="artist-mobile-content" class="lg:hidden p-6 grid grid-cols-2 gap-2 pb-24 bg-black/40 border-t border-white/5"></div>
                </div>
                <aside class="w-48 md:w-60 bg-[#08080a] border-l border-white/5 p-5 overflow-y-auto hidden lg:block shadow-2xl">
                     <h3 class="text-gray-500 text-[10px] font-bold uppercase tracking-[0.2em] mb-6 text-center">Effectifs</h3>
                     <div id="artist-sidebar-content"></div>
                </aside>
            </div>
        </section>

        <!-- SETLISTE -->
        <section id="setlist" class="page-section h-full w-full absolute inset-0 hidden overflow-y-auto p-4 md:p-10 bg-[#0b0b10]">
            <h2 class="text-4xl font-black text-white mb-8">SET <span class="text-fuchsia-600">LISTE</span></h2>
            <div id="setlist-public-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 pb-20"></div>
        </section>

        <!-- AUDIO -->
        <section id="audio" class="page-section h-full w-full absolute inset-0 hidden overflow-hidden bg-[#080510]">
            <!-- Inversion de l'ordre pour mobile : Lecteur en haut -->
            <div class="flex h-full flex-col md:flex-row">
                <!-- LE LECTEUR (En haut sur mobile, Ã  droite sur desktop) -->
                <div class="h-auto md:h-full w-full md:w-96 glass-panel flex flex-col p-4 md:p-8 border-b md:border-b-0 md:border-l border-white/10 z-20 order-1 md:order-2 shadow-2xl">
                    <div id="player-empty-state" class="flex flex-col items-center justify-center h-32 md:h-full text-center opacity-40">
                        <i class="fas fa-headphones text-3xl md:text-4xl text-fuchsia-500 mb-2 md:mb-4"></i>
                        <p class="text-[10px] md:text-xs font-bold uppercase tracking-widest">SÃ‰LECTIONNEZ UN TITRE</p>
                    </div>
                    <div id="player-content" class="hidden flex flex-col h-full">
                        <h3 id="player-title" class="text-xl md:text-2xl font-black text-white uppercase mb-4 md:mb-6 truncate">TITRE</h3>
                        <div class="bg-black/40 rounded-2xl md:rounded-3xl p-4 md:p-6 mb-4 border border-white/5">
                            <div class="flex justify-between items-center mb-4 md:mb-6">
                                <div class="flex gap-1" id="speed-controls">
                                    <button onclick="setSpeed(0.5)" class="speed-btn">0.5</button>
                                    <button onclick="setSpeed(1.0)" class="speed-btn active-speed">1.0</button>
                                    <button onclick="setSpeed(1.5)" class="speed-btn">1.5</button>
                                </div>
                                <input type="range" min="0" max="1" step="0.1" value="1" oninput="setVolume(this.value)" class="w-16">
                            </div>
                            <div class="flex justify-center items-center gap-6 mb-4 md:mb-6">
                                <button onclick="stopAudio()" class="text-gray-500 hover:text-white"><i class="fas fa-stop"></i></button>
                                <button onclick="togglePlay()" id="play-btn" class="w-12 h-12 md:w-14 md:h-14 rounded-full bg-fuchsia-600 text-white flex items-center justify-center shadow-lg"><i class="fas fa-play ml-1"></i></button>
                                <button onclick="resetAudio()" class="text-gray-500 hover:text-white"><i class="fas fa-redo-alt"></i></button>
                            </div>
                            <audio id="audio-element" ontimeupdate="updateProgress()" onended="resetPlayerUI()"></audio>
                            <div class="w-full bg-gray-800 h-1.5 rounded-full mb-2 cursor-pointer" onclick="seekAudio(event)">
                                <div id="progress-bar" class="bg-fuchsia-500 h-full w-0"></div>
                            </div>
                            <div class="flex justify-between text-[10px] text-gray-500 font-mono">
                                <span id="time-current">00:00</span>
                                <span id="time-total">00:00</span>
                            </div>
                        </div>
                        <!-- Liens compacts sur mobile -->
                        <div class="grid grid-cols-2 gap-2">
                            <a id="btn-lyrics" href="#" target="_blank" class="flex items-center justify-center gap-2 p-2 bg-blue-900/20 rounded-xl opacity-50 text-[10px] font-bold uppercase"><i class="fas fa-align-center"></i><span>Paroles</span></a>
                            <a id="btn-sheet" href="#" target="_blank" class="flex items-center justify-center gap-2 p-2 bg-orange-900/20 rounded-xl opacity-50 text-[10px] font-bold uppercase"><i class="fas fa-music"></i><span>Partit.</span></a>
                        </div>
                    </div>
                </div>

                <!-- LA LISTE (En bas sur mobile, Ã  gauche sur desktop) -->
                <div class="flex-1 flex flex-col p-4 md:p-8 overflow-hidden order-2 md:order-1">
                    <h2 class="hidden md:block text-3xl font-black text-white mb-6 uppercase">AUDIO <span class="text-fuchsia-600">PLAYER</span></h2>
                    <div class="mb-4 md:mb-6 relative">
                        <input type="text" id="audio-search" placeholder="RECHERCHER..." class="w-full bg-white/5 border border-white/10 rounded-full py-3 md:py-4 pl-12 pr-6 text-white text-sm font-bold focus:border-fuchsia-500 outline-none uppercase">
                        <i class="fas fa-search absolute left-5 top-1/2 transform -translate-y-1/2 text-gray-500"></i>
                    </div>
                    <div class="flex-1 overflow-y-auto pr-2 pb-24 md:pb-0" id="audio-track-list"></div>
                </div>
            </div>
        </section>

        <!-- ADMIN -->
        <section id="admin-panel" class="page-section h-full w-full absolute inset-0 hidden overflow-y-auto p-6 md:p-10 bg-[#0f0a18]">
            <h2 class="text-3xl font-black text-white mb-8 uppercase"><i class="fas fa-cogs text-fuchsia-600 mr-3"></i>Admin</h2>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- Artistes -->
                <div class="bg-white/5 p-6 rounded-2xl border border-white/5">
                    <h3 class="text-fuchsia-400 font-bold uppercase mb-4 text-sm">Ã‰quipe</h3>
                    <div class="grid grid-cols-2 gap-2 mb-4">
                        <input type="text" id="new-artist-name" placeholder="NOM" class="bg-black/40 p-2 rounded text-white uppercase text-xs">
                        <select id="new-artist-role" onchange="updateColorPicker()" class="bg-black/40 p-2 rounded text-white uppercase text-xs">
                            <option value="chant">CHANT</option>
                            <option value="piano">PIANO</option>
                            <option value="basse">BASSE</option>
                            <option value="drum">DRUM</option>
                        </select>
                    </div>
                    <div id="new-artist-color-picker" class="flex flex-wrap gap-2 mb-4"></div>
                    <input type="hidden" id="selected-color-value">
                    <button onclick="addNewArtist()" class="w-full bg-fuchsia-600 py-3 rounded text-white font-bold uppercase text-xs">Ajouter</button>
                    <div id="admin-team-list" class="mt-6 space-y-2"></div>
                </div>
                <!-- Audio Admin -->
                <div class="bg-white/5 p-6 rounded-2xl border border-white/5">
                    <h3 class="text-fuchsia-400 font-bold uppercase mb-4 text-sm">BibliothÃ¨que Audio</h3>
                    <input type="hidden" id="audio-id-input">
                    <input type="text" id="audio-title-input" placeholder="TITRE" class="w-full bg-black/40 p-3 rounded mb-4 text-white uppercase text-xs">
                    <div class="grid grid-cols-3 gap-2 mb-4">
                        <button onclick="document.getElementById('upload-input-audio').click()" id="upload-btn-audio" class="upload-btn"><i class="fas fa-music mb-2"></i><span>Audio</span></button>
                        <button onclick="document.getElementById('upload-input-lyrics').click()" id="upload-btn-lyrics" class="upload-btn"><i class="fas fa-align-center mb-2"></i><span>Paroles</span></button>
                        <button onclick="document.getElementById('upload-input-sheet').click()" id="upload-btn-sheet" class="upload-btn"><i class="fas fa-scroll mb-2"></i><span>Partit.</span></button>
                    </div>
                    <input type="file" id="upload-input-audio" class="hidden" accept="audio/*" onchange="uploadSingleFile(this, 'mp3', 'upload-btn-audio', 'audio-src-input')">
                    <input type="file" id="upload-input-lyrics" class="hidden" accept=".pdf" onchange="uploadSingleFile(this, 'lyrics', 'upload-btn-lyrics', 'audio-lyrics-input')">
                    <input type="file" id="upload-input-sheet" class="hidden" accept=".pdf" onchange="uploadSingleFile(this, 'sheet', 'upload-btn-sheet', 'audio-sheet-input')">
                    <input type="hidden" id="audio-src-input"><input type="hidden" id="audio-lyrics-input"><input type="hidden" id="audio-sheet-input">
                    <input type="text" id="audio-youtube-input" placeholder="Lien YouTube" class="w-full bg-black/40 p-2 rounded mb-4 text-white text-xs">
                    <div class="flex items-center gap-2 mb-4 bg-fuchsia-900/20 p-2 rounded">
                        <input type="checkbox" id="audio-is-new">
                        <label for="audio-is-new" class="text-[10px] font-bold uppercase text-white">NouveautÃ© Ã  travailler</label>
                    </div>
                    <button onclick="saveAudioTrack()" class="w-full bg-fuchsia-600 py-3 rounded text-white font-bold uppercase text-xs mb-4">Sauvegarder Titre</button>
                    <div id="admin-audio-list" class="space-y-2 max-h-48 overflow-y-auto"></div>
                </div>
            </div>
            <!-- Setlists Admin -->
            <div class="mt-8 bg-white/5 p-6 rounded-2xl border border-white/5">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-blue-400 font-bold uppercase text-sm">Setlistes Hebdo</h3>
                    <button onclick="saveSetlistsOnly()" class="bg-green-600 px-6 py-2 rounded-full text-white text-[10px] font-bold uppercase">Enregistrer</button>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                    <div><input type="text" id="date-wed" class="w-full bg-transparent border-b border-white/10 text-xs mb-1" placeholder="MER 12"><textarea id="setlist-wed" class="admin-textarea w-full h-48 rounded p-2"></textarea></div>
                    <div><input type="text" id="date-thu" class="w-full bg-transparent border-b border-white/10 text-xs mb-1" placeholder="JEU 13"><textarea id="setlist-thu" class="admin-textarea w-full h-48 rounded p-2"></textarea></div>
                    <div><input type="text" id="date-fri" class="w-full bg-transparent border-b border-white/10 text-xs mb-1" placeholder="VEN 14"><textarea id="setlist-fri" class="admin-textarea w-full h-48 rounded p-2"></textarea></div>
                    <div><input type="text" id="date-sat" class="w-full bg-transparent border-b border-white/10 text-xs mb-1" placeholder="SAM 15"><textarea id="setlist-sat" class="admin-textarea w-full h-48 rounded p-2"></textarea></div>
                </div>
            </div>
        </section>
    </main>

    <!-- TOASTS -->
    <div id="toast-notification" class="fixed bottom-10 left-1/2 transform -translate-x-1/2 bg-green-600 text-white px-6 py-3 rounded-full shadow-lg z-[100] opacity-0 font-bold text-xs uppercase transition-all pointer-events-none flex items-center gap-2">
        <i class="fas fa-check-circle"></i> <span id="toast-msg">EnregistrÃ©</span>
    </div>
    <div id="error-toast" class="fixed bottom-10 left-1/2 transform -translate-x-1/2 bg-red-600 text-white px-6 py-3 rounded-full shadow-lg z-[100] opacity-0 font-bold text-xs uppercase transition-all pointer-events-none flex items-center gap-2">
        <i class="fas fa-exclamation-circle"></i> <span id="error-message">Erreur</span>
    </div>

    <!-- MODALS -->
    <div id="password-modal" class="fixed inset-0 bg-black/95 z-[100] hidden flex items-center justify-center p-4">
        <div class="bg-[#1a0b2e] border border-fuchsia-500/30 rounded-2xl p-8 w-full max-w-sm text-center">
            <h3 class="text-white font-black text-xl mb-6 uppercase">Admin Mondaine</h3>
            <input type="password" id="admin-pass-input" class="w-full bg-black/50 border border-white/10 rounded p-3 text-center text-white mb-4 focus:border-fuchsia-500 outline-none" placeholder="â€¢â€¢â€¢â€¢">
            <div class="grid grid-cols-2 gap-3">
                <button onclick="closeModal('password-modal')" class="py-3 border border-gray-700 text-gray-400 rounded-lg text-xs font-bold uppercase">Annuler</button>
                <button onclick="checkAdminPassword()" class="py-3 bg-fuchsia-600 text-white rounded-lg text-xs font-bold uppercase">OK</button>
            </div>
        </div>
    </div>

    <div id="assign-modal" class="fixed inset-0 bg-black/90 z-50 hidden flex items-center justify-center p-4">
        <div class="bg-[#1a0b2e] border border-fuchsia-500/30 rounded-2xl p-6 w-full max-w-sm">
            <h3 class="text-white font-bold uppercase text-xs mb-4 text-center border-b border-white/10 pb-2" id="modal-slot-info">Date</h3>
            <div id="modal-artist-list" class="grid grid-cols-2 gap-2 max-h-60 overflow-y-auto pr-1"></div>
            <button onclick="removeAssignment()" class="w-full mt-4 py-3 border border-red-500/30 text-red-400 rounded-lg text-xs font-bold uppercase">Retirer l'artiste</button>
        </div>
    </div>

    <!-- SCRIPTS -->
    <script>
        let ARTISTS = [];
        let assignments = {};
        let SETLISTS = { wed: { date: "MER", content: "" }, thu: { date: "JEU", content: "" }, fri: { date: "VEN", content: "" }, sat: { date: "SAM", content: "" } };
        let AUDIO_LIBRARY = [];
        let currentDate = new Date(); 
        let selectedArtistId = null;
        let highlightedRow = null;
        let currentEditSlot = null;
        let isAdminMode = false;
        let currentTrack = null;
        let lastPlayStart = 0;

        const PUBLIC_DOC = (col, id) => window.doc(window.db, 'artifacts', window.appId, 'public', 'data', col, id);

        function showToast(msg) {
            const t = document.getElementById('toast-notification');
            if(msg) document.getElementById('toast-msg').innerText = msg;
            t.classList.add('toast-visible'); setTimeout(() => t.classList.remove('toast-visible'), 3000);
        }
        function showErrorToast(msg) {
            const t = document.getElementById('error-toast');
            document.getElementById('error-message').innerText = msg;
            t.classList.add('opacity-100'); setTimeout(() => t.classList.remove('opacity-100'), 5000);
        }

        window.uploadSingleFile = function(input, type, btnId, targetId) {
            const file = input.files[0]; if (!file) return;
            const btn = document.getElementById(btnId);
            btn.innerHTML = `<i class="fas fa-spinner fa-spin"></i>`;
            btn.classList.add('upload-loading');

            const path = `artifacts/${window.appId}/public/audio/${type}/${Date.now()}_${file.name}`;
            const ref = window.storageRef(window.storage, path);
            const task = window.uploadBytesResumable(ref, file);

            task.on('state_changed', null, (e) => { showErrorToast("Ã‰chec upload"); btn.innerHTML = "ERR"; }, () => {
                window.getDownloadURL(task.snapshot.ref).then(url => {
                    document.getElementById(targetId).value = url;
                    btn.classList.replace('upload-loading', 'upload-success');
                    btn.innerHTML = `<i class="fas fa-check"></i>`;
                });
            });
        };

        function renderPlanning() {
            const container = document.getElementById('planning-container');
            const sidebar = document.getElementById('artist-sidebar-content');
            const mobileContainer = document.getElementById('artist-mobile-content');
            
            const monthName = currentDate.toLocaleDateString('fr-FR', {month: 'long'}).toUpperCase();
            document.getElementById('current-month-display').textContent = `${monthName} ${currentDate.getFullYear()}`;

            let gridHTML = `<div class="flex-1 overflow-x-auto pb-4"><div class="min-w-[900px] grid grid-cols-[80px_1fr_1fr_1fr_20px_1fr_1fr_1fr] gap-1.5 text-center pb-10 pr-4">
                <div class=""></div><div class="col-span-3 bg-purple-900/40 p-2 rounded-t text-[10px] font-bold uppercase tracking-widest">Chants</div><div class=""></div><div class="col-span-3 bg-blue-900/40 p-2 rounded-t text-[10px] font-bold uppercase tracking-widest">Musiciens</div>
                <div class="sticky-col bg-white/5 text-gray-400 font-bold text-[10px] uppercase py-3 border border-white/5">DATES</div>
                <div class="bg-purple-500/10 text-purple-200 text-[9px] uppercase py-3 border border-white/5">Chant 1</div><div class="bg-purple-500/10 text-purple-200 text-[9px] uppercase py-3 border border-white/5">Chant 2</div><div class="bg-purple-500/10 text-purple-200 text-[9px] uppercase py-3 border border-white/5">Chant 3</div><div class=""></div>
                <div class="bg-blue-500/10 text-blue-200 text-[9px] uppercase py-3 border border-white/5">Piano</div><div class="bg-blue-500/10 text-blue-200 text-[9px] uppercase py-3 border border-white/5">Basse</div><div class="bg-blue-500/10 text-blue-200 text-[9px] uppercase py-3 border border-white/5">Drum</div>`;

            const d = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1);
            while(d.getMonth() === currentDate.getMonth()) {
                if([3,4,5,6].includes(d.getDay())) {
                    const dateStr = [d.getFullYear(), String(d.getMonth()+1).padStart(2,'0'), String(d.getDate()).padStart(2,'0')].join('-');
                    const isSat = d.getDay() === 6;
                    const isRowActive = highlightedRow === dateStr;
                    const dateCellBg = isRowActive ? 'bg-fuchsia-800' : (isSat ? 'bg-[#2a1b3d]' : 'bg-[#1a0b2e]');
                    
                    gridHTML += `<div onclick="toggleRowHighlight('${dateStr}')" class="sticky-col h-16 flex flex-col justify-center items-center border border-white/5 rounded-lg ${dateCellBg} cursor-pointer group ${isRowActive?'row-active':''}">
                        <span class="text-[8px] uppercase text-fuchsia-300">${d.toLocaleDateString('fr-FR', {weekday: 'short'})}</span>
                        <span class="text-lg font-black text-white leading-none">${d.getDate()}</span>
                    </div>`;

                    ['chant1', 'chant2', 'chant3', 'sep', 'piano', 'basse', 'drum'].forEach(slot => {
                        if(slot === 'sep') gridHTML += `<div></div>`;
                        else {
                            const artistId = assignments[`${dateStr}_${slot}`];
                            const artist = ARTISTS.find(a => a.id === artistId);
                            let cellClass = `h-16 border border-white/5 flex items-center justify-center rounded transition-all ${isRowActive?'row-active':''} `;
                            let content = '';
                            if(artist) {
                                cellClass += `${artist.color} `;
                                if(selectedArtistId && artist.id !== selectedArtistId) cellClass += `cell-dimmed `;
                                content = `<span class="font-bold text-[10px] px-1 truncate">${artist.name}</span>`;
                            } else {
                                cellClass += `bg-black/20 `;
                                if(selectedArtistId) cellClass += `cell-dimmed `;
                                if(isAdminMode) content = `<i class="fas fa-plus text-white/10"></i>`;
                            }
                            gridHTML += `<div class="${cellClass}" onclick="${isAdminMode?`handleCellClick('${dateStr}','${slot}')`:''}">${content}</div>`;
                        }
                    });
                    if(isSat) gridHTML += `<div class="col-span-8 h-2"></div>`;
                }
                d.setDate(d.getDate() + 1);
            }
            gridHTML += `</div></div>`;
            container.innerHTML = gridHTML;

            // Remplissage de la lÃ©gende (Desktop et Mobile)
            const artistItemsHTML = ARTISTS.map(a => `<button onclick="toggleArtistFilter('${a.id}')" class="w-full p-2 rounded text-[10px] font-bold uppercase transition-all shadow-md ${a.color} ${selectedArtistId===a.id?'ring-2 ring-white scale-105':'opacity-70 hover:opacity-100'}">${a.name}</button>`).join('');
            
            if(sidebar) sidebar.innerHTML = artistItemsHTML;
            if(mobileContainer) mobileContainer.innerHTML = artistItemsHTML;
        }

        window.toggleRowHighlight = (d) => { highlightedRow = (highlightedRow===d)?null:d; renderPlanning(); };
        window.toggleArtistFilter = (id) => { selectedArtistId = (selectedArtistId===id)?null:id; renderPlanning(); };

        function renderAudioList(term='') {
            const list = document.getElementById('audio-track-list');
            const filtered = AUDIO_LIBRARY.filter(t => t.title.toLowerCase().includes(term.toLowerCase())).sort((a,b)=>a.title.localeCompare(b.title));
            list.innerHTML = filtered.map(t => `<button onclick="selectTrack('${t.id}')" class="track-item w-full text-left p-4 text-gray-400 font-bold uppercase flex justify-between items-center ${currentTrack?.id===t.id?'active':''}">
                <span class="truncate pr-4">${t.isNew?'ðŸš¨ ':''}${t.title}</span><i class="fas fa-play text-[10px] shrink-0"></i>
            </button>`).join('');
        }

        window.selectTrack = (id) => {
            currentTrack = AUDIO_LIBRARY.find(t => t.id === id);
            document.getElementById('player-empty-state').classList.add('hidden');
            document.getElementById('player-content').classList.remove('hidden');
            document.getElementById('player-title').innerText = currentTrack.title;
            const a = document.getElementById('audio-element');
            a.src = currentTrack.src || "";
            a.currentTime = 0; lastPlayStart = 0;
            updateBtn('btn-lyrics', currentTrack.lyrics);
            updateBtn('btn-sheet', currentTrack.sheet);
            renderAudioList(document.getElementById('audio-search').value);
        };

        function updateBtn(id, link) {
            const b = document.getElementById(id); 
            if(!b) return;
            b.href = link || "#";
            if(link) {
                b.classList.replace('opacity-50', 'opacity-100');
                b.classList.replace('cursor-not-allowed', 'cursor-pointer');
            } else {
                b.classList.replace('opacity-100', 'opacity-50');
                b.classList.add('cursor-not-allowed');
            }
        }

        window.togglePlay = () => {
            const a = document.getElementById('audio-element'); const i = document.getElementById('play-btn').querySelector('i');
            if(a.paused) { a.play(); i.className = "fas fa-pause"; lastPlayStart = a.currentTime; }
            else { a.pause(); i.className = "fas fa-play ml-1"; }
        };
        window.stopAudio = () => { const a = document.getElementById('audio-element'); a.pause(); a.currentTime = 0; resetPlayerUI(); };
        window.resetAudio = () => { const a = document.getElementById('audio-element'); a.currentTime = lastPlayStart; a.play(); };
        window.resetPlayerUI = () => { document.getElementById('play-btn').querySelector('i').className = "fas fa-play ml-1"; };
        window.updateProgress = () => {
            const a = document.getElementById('audio-element');
            if(a.duration) {
                document.getElementById('progress-bar').style.width = `${(a.currentTime/a.duration)*100}%`;
                document.getElementById('time-current').innerText = formatTime(a.currentTime);
                document.getElementById('time-total').innerText = formatTime(a.duration);
            }
        };
        function formatTime(s) { const m = Math.floor(s/60); const sc = Math.floor(s%60); return `${m}:${sc.toString().padStart(2,'0')}`; }
        window.seekAudio = (e) => { const a = document.getElementById('audio-element'); a.currentTime = (e.offsetX / e.currentTarget.clientWidth) * a.duration; };
        window.setSpeed = (s) => { document.getElementById('audio-element').playbackRate = s; document.querySelectorAll('.speed-btn').forEach(b => b.classList.toggle('active-speed', parseFloat(b.innerText)===s)); };
        window.setVolume = (v) => { document.getElementById('audio-element').volume = v; };

        window.initRealtimeData = () => {
            onSnapshot(collection(window.db, 'artifacts', window.appId, 'public', 'data', 'artists'), s => { ARTISTS = s.docs.map(d=>d.data()); renderAdminTeamList(); renderPlanning(); });
            onSnapshot(collection(window.db, 'artifacts', window.appId, 'public', 'data', 'planning'), s => { assignments = {}; s.forEach(d=>assignments[d.id]=d.data().artistId); renderPlanning(); });
            onSnapshot(collection(window.db, 'artifacts', window.appId, 'public', 'data', 'audio'), s => { AUDIO_LIBRARY = s.docs.map(d=>d.data()); renderAudioList(); renderAdminAudioList(); renderHomeNews(); });
            onSnapshot(collection(window.db, 'artifacts', window.appId, 'public', 'data', 'setlists'), s => { s.forEach(d=>{if(SETLISTS[d.id]) SETLISTS[d.id]=d.data();}); renderSetlistPublic(); });
            document.getElementById('loading-overlay').classList.add('opacity-0', 'pointer-events-none');
        };

        window.addNewArtist = async () => {
            const name = document.getElementById('new-artist-name').value.toUpperCase().trim();
            const color = document.getElementById('selected-color-value').value;
            if(!name || !color) return;
            const id = Date.now().toString();
            await setDoc(PUBLIC_DOC('artists', id), { id, name, color, role: document.getElementById('new-artist-role').value });
            document.getElementById('new-artist-name').value = ''; showToast();
        };

        window.saveAudioTrack = async () => {
            const title = document.getElementById('audio-title-input').value.toUpperCase().trim(); if(!title) return;
            const id = document.getElementById('audio-id-input').value || Date.now().toString();
            await setDoc(PUBLIC_DOC('audio', id), { id, title, isNew: document.getElementById('audio-is-new').checked, src: document.getElementById('audio-src-input').value, lyrics: document.getElementById('audio-lyrics-input').value, sheet: document.getElementById('audio-sheet-input').value, youtube: document.getElementById('audio-youtube-input').value });
            clearAudioForm(); showToast();
        };

        window.renderHomeNews = () => {
            const c = document.getElementById('home-news-container'); const nt = AUDIO_LIBRARY.filter(t => t.isNew);
            if(!nt.length) { c.classList.add('hidden'); return; }
            c.classList.remove('hidden');
            c.innerHTML = `<div class="bg-red-900/80 p-4 rounded-xl border border-red-500/50 shadow-lg animate-pulse">
                <h3 class="text-white font-black text-xs mb-3">ðŸš¨ NOUVEAUTÃ‰ Ã€ TRAVAILLER</h3>
                ${nt.map(t => `<div class="bg-black/40 p-3 rounded flex justify-between items-center mb-2">
                    <span class="text-white font-bold text-xs">${t.title}</span>
                    <button onclick="playNewsTrack('${t.id}')" class="bg-white text-red-900 px-4 py-1 rounded-full text-[10px] font-bold">Ã‰COUTER</button>
                </div>`).join('')}
            </div>`;
        };
        window.playNewsTrack = (id) => { showPage('audio'); setTimeout(() => selectTrack(id), 100); };

        function renderSetlistPublic() {
            const c = document.getElementById('setlist-public-container');
            const d = [{k:'wed',c:'blue'},{k:'thu',c:'purple'},{k:'fri',c:'pink'},{k:'sat',c:'indigo'}];
            c.innerHTML = d.map(day => `<div class="bg-${day.c}-900/10 border border-${day.c}-500/30 rounded-3xl overflow-hidden flex flex-col h-full">
                <div class="bg-${day.c}-600 p-4 text-center text-white font-bold">${SETLISTS[day.k].date}</div>
                <div class="p-6 text-xs text-gray-200 flex-1 whitespace-pre-wrap">${SETLISTS[day.k].content}</div>
                <button onclick="copySet('${day.k}')" class="m-3 p-2 bg-white/5 rounded text-[10px] uppercase font-bold text-gray-400">Copier</button>
            </div>`).join('');
        }
        window.copySet = (id) => { navigator.clipboard.writeText(SETLISTS[id].content); showToast("CopiÃ© !"); };

        window.saveSetlistsOnly = async () => {
            for(let k of ['wed','thu','fri','sat']) {
                SETLISTS[k].date = document.getElementById('date-'+k).value;
                SETLISTS[k].content = document.getElementById('setlist-'+k).value;
                await setDoc(PUBLIC_DOC('setlists', k), SETLISTS[k]);
            }
            showToast();
        };

        window.showPage = (id) => {
            document.querySelectorAll('.page-section').forEach(p => p.classList.add('hidden'));
            document.getElementById(id).classList.remove('hidden');
            document.querySelectorAll('.nav-item').forEach(n => n.classList.toggle('active', n.id==='nav-'+id));
            if(id === 'admin-panel') loadAdminValues();
        };

        function loadAdminValues() {
            for(let k of ['wed','thu','fri','sat']) {
                if(document.getElementById('date-'+k)) document.getElementById('date-'+k).value = SETLISTS[k].date || '';
                if(document.getElementById('setlist-'+k)) document.getElementById('setlist-'+k).value = SETLISTS[k].content || '';
            }
            renderAdminTeamList();
            renderAdminAudioList();
        }

        window.toggleSidebar = () => { document.getElementById('main-sidebar').classList.toggle('sidebar-collapsed'); };
        window.toggleAdminMode = () => { if(isAdminMode) { isAdminMode=false; updateAdminUI(); } else document.getElementById('password-modal').classList.remove('hidden'); };
        window.checkAdminPassword = () => { if(document.getElementById('admin-pass-input').value==='mondaine') { isAdminMode=true; updateAdminUI(); closeModal('password-modal'); } };
        window.updateAdminUI = () => { document.getElementById('admin-nav-item').classList.toggle('hidden', !isAdminMode); renderPlanning(); };
        window.closeModal = (id) => document.getElementById(id).classList.add('hidden');
        window.handleCellClick = (d, s) => { currentEditSlot = {dateStr:d, slot:s}; renderModalArtists(); document.getElementById('assign-modal').classList.remove('hidden'); };
        
        function renderModalArtists() {
            document.getElementById('modal-artist-list').innerHTML = ARTISTS.map(a => `<button onclick="setAssign('${a.id}')" class="${a.color} p-3 rounded font-bold text-[10px] uppercase">${a.name}</button>`).join('');
        }
        window.setAssign = async (id) => { await setDoc(PUBLIC_DOC('planning', `${currentEditSlot.dateStr}_${currentEditSlot.slot}`), { artistId: id }); closeModal('assign-modal'); };
        window.removeAssignment = async () => { await deleteDoc(PUBLIC_DOC('planning', `${currentEditSlot.dateStr}_${currentEditSlot.slot}`)); closeModal('assign-modal'); };

        function clearAudioForm() {
            document.querySelectorAll('#admin-panel input').forEach(i => { if(i.type!=='hidden'&&i.type!=='checkbox') i.value=''; });
            document.getElementById('audio-id-input').value=''; document.getElementById('audio-is-new').checked=false;
            document.querySelectorAll('.upload-btn').forEach(b => { b.classList.remove('upload-success'); b.innerHTML = b.id.includes('audio') ? '<i class="fas fa-music"></i>' : (b.id.includes('lyrics') ? '<i class="fas fa-align-center"></i>' : '<i class="fas fa-scroll"></i>'); });
        }
        
        function renderAdminAudioList() {
            document.getElementById('admin-audio-list').innerHTML = AUDIO_LIBRARY.map(t => `<div class="bg-white/5 p-2 rounded flex justify-between items-center mb-1"><span class="text-[10px] text-white">${t.title}</span><div class="flex gap-1"><button onclick="editAudio('${t.id}')" class="text-blue-400 p-1"><i class="fas fa-edit"></i></button><button onclick="deleteAudio('${t.id}')" class="text-red-400 p-1"><i class="fas fa-trash"></i></button></div></div>`).join('');
        }

        function renderAdminTeamList() {
             const container = document.getElementById('admin-team-list');
             if(!container) return;
             const categories = [
                { id: 'chant', label: 'CHANTS', icon: 'fa-microphone-alt', color: 'text-fuchsia-400' },
                { id: 'piano', label: 'PIANO', icon: 'fa-keyboard', color: 'text-green-400' },
                { id: 'basse', label: 'BASSE', icon: 'fa-guitar', color: 'text-blue-400' },
                { id: 'drum', label: 'BATTERIE', icon: 'fa-drum', color: 'text-red-400' }
            ];
            container.innerHTML = categories.map(cat => {
                const catArtists = ARTISTS.filter(a => a.role === cat.id);
                return `<div class="mb-4">
                    <h4 class="text-[10px] font-bold uppercase mb-2 ${cat.color} border-b border-white/5 pb-1"><i class="fas ${cat.icon} mr-1"></i> ${cat.label}</h4>
                    <div class="grid grid-cols-2 gap-2">
                        ${catArtists.map(a => `<div class="flex justify-between items-center bg-black/30 p-2 rounded border border-white/5 group">
                            <span class="text-[10px] font-bold ${a.color} px-2 py-1 rounded">${a.name}</span>
                            <button onclick="deleteArtist('${a.id}')" class="text-gray-600 hover:text-red-500 p-1"><i class="fas fa-times"></i></button>
                        </div>`).join('')}
                    </div>
                </div>`;
            }).join('');
        }

        window.deleteArtist = async (id) => { if(confirm("Supprimer l'artiste ?")) await deleteDoc(PUBLIC_DOC('artists', id)); };
        window.editAudio = (id) => { const t = AUDIO_LIBRARY.find(a=>a.id===id); document.getElementById('audio-id-input').value=t.id; document.getElementById('audio-title-input').value=t.title; document.getElementById('audio-is-new').checked=t.isNew; document.getElementById('audio-src-input').value=t.src; };
        window.deleteAudio = async (id) => { if(confirm("Supprimer ?")) await deleteDoc(PUBLIC_DOC('audio', id)); };

        function updateColorPicker() {
            const colors = ['bg-pink-500','bg-fuchsia-500','bg-purple-500','bg-indigo-500','bg-blue-500','bg-teal-500','bg-green-500','bg-yellow-500','bg-orange-500','bg-red-500'];
            document.getElementById('new-artist-color-picker').innerHTML = colors.map(c => `<div class="w-6 h-6 rounded-full cursor-pointer border-2 border-transparent hover:border-white transition-all ${c}" onclick="selectColor(this,'${c} text-white')"></div>`).join('');
            selectColor(null, colors[0]+' text-white');
        }
        window.selectColor = (el, c) => { document.getElementById('selected-color-value').value=c; document.querySelectorAll('#new-artist-color-picker div').forEach(d=>d.style.transform=(el===d)?'scale(1.2)':'scale(1)'); };

        window.onload = () => { showPage('home'); updateColorPicker(); window.addEventListener('beforeunload', (e)=>{e.preventDefault(); e.returnValue='';}); };
    </script>
</body>
</html>
